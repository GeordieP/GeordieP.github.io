<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/safari-pinned-tab.svg" rel="mask-icon" color="#3BA3E8"><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"><meta content="#2d89ef" name="msapplication-TileColor"><meta content="#8a73ff" name="theme-color"><link href="/manifest.json" rel="manifest"><title>Geordie Powers</title><link href="/static/css/main.7e2b7afe.chunk.css" rel="stylesheet"><link href="/static/js/16.685cfdbc.chunk.js" rel="preload" as="script"><link href="/static/js/main.c79bbdec.chunk.js" rel="preload" as="script"><link href="/static/js/15.bec5874a.chunk.js" rel="preload" as="script"><link href="/static/js/5.4600a1b2.chunk.js" rel="preload" as="script"><link href="/static/js/3.c7af5567.chunk.js" rel="preload" as="script"></head><body><div id="root"><div class="Layout Layout--standard fastFade"><nav class="u-flexH u-spaceBetween u-centerMain"><div><a href="/"><svg class="LogoSvg" enable-background="new 0 0 200 200" height="200px" id="Layer_1" version="1.1" viewBox="0 0 200 200" width="200px" x="0px" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><linearGradient gradientUnits="userSpaceOnUse" id="SVGID_1_" x1="148.8818" x2="51.1174" y1="15.3335" y2="184.6664"><stop offset="0" style="stop-color:#3ba3e8"></stop><stop offset="1" style="stop-color:#8a73ff"></stop></linearGradient><path d="M148.647,23.135c-28.3,0-51.244,22.944-51.244,51.243v9.72v31.804v9.72 c0,25.432-20.618,46.05-46.05,46.05c-25.432,0-46.051-20.618-46.051-46.05c0-25.432,20.619-46.051,46.051-46.051h28.576v-5.192 H51.353c-28.301,0-51.243,22.942-51.243,51.243s22.942,51.244,51.243,51.244s51.244-22.943,51.244-51.244v-9.72V84.098v-9.72 c0-25.432,20.617-46.05,46.051-46.05c25.433,0,46.05,20.618,46.05,46.05s-20.617,46.051-46.05,46.051h-28.576v5.192h28.576 c28.301,0,51.243-22.942,51.243-51.243C199.891,46.079,176.948,23.135,148.647,23.135z" fill="url(#SVGID_1_)"></path><rect fill="url(#SVGID_1_)" height="5.192" width="17.475" x="62.455" y="120.429"></rect></svg></a></div><div><a href="/projects">Projects</a><a href="/blog">Blog</a><a href="/contact">Contact</a></div></nav><main><div><h1 id="testing-components---hyperapp-elfinder">Testing Components - Hyperapp ElFinder</h1><h4 id="april-8-2018">April 8, 2018</h4><p><em>(ElFinder function source can be found at the bottom of this post)</em></p><p>Testing Hyperapp components can be a pain. Often the attribute or value we’re trying to validate is buried under several layers of virtual DOM nodes, and the logic required to drill down to the single element we’re looking for can end up being unreadable, messy, and repetitive.</p><p>Consider the following component:</p><pre class="language-jsx"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">TestComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token punctuation">,</span> title<span class="token punctuation">,</span> blurb<span class="token punctuation">,</span> content<span class="token punctuation">,</span> footerContent <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>rootEl<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>placeholder<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>importantInfo<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>importantInfo_inner<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>commonClNm info_summary<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>summary_title<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> key <span class="token operator">+</span> <span class="token string">'_summary_title'</span> <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> title <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>summary_blurb<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> key <span class="token operator">+</span> <span class="token string">'_summary_blurb'</span> <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                        </span><span class="token punctuation">{</span> blurb <span class="token punctuation">}</span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">

                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>commonClNm<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> key <span class="token operator">+</span> <span class="token string">'_details_content'</span> <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">

                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>commonClNm<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> key <span class="token operator">+</span>  <span class="token string">'_details_footer'</span> <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token punctuation">{</span> footerContent <span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span>
</code></pre><p>Given the test case:</p><pre><code>Verify the summary blurb element was given the correct ID, and contains the expected text.
</code></pre><p>One approach is to simply march down the tree referencing children by index.</p><ul><li><em>Test Example 1.</em></li></ul><pre class="language-jsx"><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Blurb element renders given text in element with expected ID.'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
        key<span class="token punctuation">:</span> <span class="token string">'first'</span><span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token string">'FirstPost'</span><span class="token punctuation">,</span>
        blurb<span class="token punctuation">:</span> <span class="token string">'A small blurb about the content'</span><span class="token punctuation">,</span>
        content<span class="token punctuation">:</span> <span class="token string">'The full content'</span><span class="token punctuation">,</span>
        footerContent<span class="token punctuation">:</span> <span class="token string">'Date'</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> el_root <span class="token operator">=</span> <span class="token function">TestComponent</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token comment">//</span>
    <span class="token comment">// Climb down through each element's children to find what we're looking for</span>
    <span class="token comment">//</span>

    <span class="token keyword">const</span> el_blurb <span class="token operator">=</span> el_root
        <span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token comment">// div.importantInfo</span>
        <span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>     <span class="token comment">// div.importantInfo_inner</span>
        <span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>     <span class="token comment">// div.info_summary</span>
        <span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token comment">// h3.summary_blurb</span>

    <span class="token comment">// verify ID is correct</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>el_blurb<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_summary_blurb`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// verify content is correct</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>el_blurb<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>blurb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>While this works, it’s quite difficult to read (especially without the helpful comments), and can be broken by the simplest of component layout changes.</p><p>Another approach is a bit less likely to be broken by small changes, but requires a lot more code and in some cases may end up being even less readable:</p><ul><li><em>Test Example 2a.</em></li></ul><pre class="language-jsx"><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Blurb element renders given text in element with expected ID.'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">const</span> el_blurb <span class="token operator">=</span> el_root
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'importantInfo'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'importantInfo_inner'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'info_summary'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'summary_blurb'</span><span class="token punctuation">)</span>

    <span class="token comment">/// ERROR! ///</span>

    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>Now that we’re using element attributes, the test will no longer break if an item is moved before or after a sibling in the markup, and we find it easier to understand which element we’re looking at during each step.</p><p>The biggest issue with this, as shown by the comment, is that it throws an error;</p><p><code>TypeError: Cannot read property 'children' of undefined</code></p><p>Unfortunately, basic console output doesn’t do a good job of telling us where this error came from; it claims it originates from the line of the assignment.</p><p>With some investigation, we can determine that the error is coming from the fact that our search for a child element with the className <code>info_summary</code> returned <code>undefined</code>. If we take another look at the component markup, we can see why this is:</p><pre class="language-jsx"><code class="language-js">    <span class="token operator">...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>commonClNm info_summary<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    ...
</span></code></pre><p>The <code>info_summary</code> element has two classes applied (the other being <code>commonClNm</code>), so the string match didn’t work like it had in previous lines. It’s easy enough to fix.</p><ul><li><em>Test Example 2b.</em></li></ul><pre class="language-jsx"><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Blurb element renders given text in element with expected ID.'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">const</span> el_blurb <span class="token operator">=</span> el_root
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'importantInfo'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'importantInfo_inner'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'info_summary'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// Error fixed</span>
          <span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">'summary_blurb'</span><span class="token punctuation">)</span>

    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>That’s fine for this case, but will obviously get tiring to write after a while.</p><p>With the intention of staying as light as possible on library dependencies, there are a number of other ways people test their Hyperapp components; as far as I’ve seen, the two most common are:</p><ul><li>Reproducing the component’s markup inside the test file using standard <code>h()</code> calls, and comparing the output with the virtual dom object tree returned by the imported component after having run both through <code>JSON.stringify()</code>.</li><li>Mocking the expected output of the component <code>h()</code> call; reproduce the virtual dom tree (using hard-coded object and array literals, strings, numbers, etc) at each level until the desired element is reached, and then compare the real component tree with the mock tree (Again, often by <code>stringify</code>-ing both and comparing the results).</li></ul><p>During my initial search, I found neither of these methods appealing, mostly because they both require a lot of mock writing; certainly undesirable when testing modules that tend to change often.</p><h2 id="a-simpler-way">A simpler way</h2><p>The solution I’ve gone with, a function I’ve named “ElFinder”, attempts to offer the simplicity of Example 1 with the specificity of Example 2b.</p><p>Here’s how the same test case from above ends up looking using the ElFinder function:</p><ul><li><em>Example 3a.</em></li></ul><pre class="language-jsx"><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Blurb element renders given text in element with expected ID.'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">const</span> el_blurb <span class="token operator">=</span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el_root<span class="token punctuation">)</span>                  <span class="token comment">// call ElFinder, pass an object returned from h().</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'importantInfo'</span><span class="token punctuation">)</span>          <span class="token comment">// use ElFinder methods to step down the tree.</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'importantInfo_inner'</span><span class="token punctuation">)</span>    <span class="token comment">// each call returns an ElFinder object, so fn calls can be chained.</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'info_summary'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'summary_blurb'</span><span class="token punctuation">)</span>

    <span class="token comment">// ... (rest of test is the same as previous full examples)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>Although the only method in use here is <code>firstChild.byClass</code>, others are quite useful as well. Another way to get to the same resulting element (although less resilient to change) could be:</p><ul><li><em>Example 3b.</em></li></ul><pre class="language-jsx"><code class="language-js">    <span class="token comment">// ...</span>

    <span class="token keyword">const</span> el_blurb <span class="token operator">=</span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el_root<span class="token punctuation">)</span>
          <span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">atIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                          <span class="token comment">// div.importantInfo</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'importantInfo_inner'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                      <span class="token comment">// div.info_summary</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'summary_blurb'</span><span class="token punctuation">)</span>

    <span class="token comment">// ...</span>
</code></pre><p>In example 3b, we get some of the children by index rather than by matching their attributes.</p><p>In some cases, these functions allow us to not only make our tests more specific, but also to simplify and omit steps:</p><ul><li><em>Example 4.</em></li></ul><pre class="language-jsx"><code class="language-js">    <span class="token comment">// ...</span>

    <span class="token keyword">const</span> el_blurb <span class="token operator">=</span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el_root<span class="token punctuation">)</span>
          <span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">atIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'importantInfo_inner'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byId</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_summary_blurb`</span></span><span class="token punctuation">)</span>  <span class="token comment">// use ID to find element here</span>

    <span class="token comment">// NOTE:</span>
    <span class="token comment">// This check is no longer needed, existence of element with matching ID is checked</span>
    <span class="token comment">// when we access firstChild.byId above.</span>
    <span class="token comment">//</span>
    <span class="token comment">// verify ID is correct</span>
    <span class="token comment">// expect(el_blurb.attributes.id)</span>
    <span class="token comment">//    .toEqual(`${props.key}_summary_blurb`)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>el_blurb<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>blurb<span class="token punctuation">)</span>

    <span class="token comment">// ...</span>
</code></pre><p>Using the ID to find a child element in this case allows us to exclude the standalone ID check that was used in all the other examples. If the call to <code>firstChild.byId</code> returns undefined, the test will fail and we’ll know the ID was invalid.</p><p>Some of the ElFinder functions return arrays, allowing us to keep tests concise and clean. Here we store references to several elements who share the same parent and class name.</p><ul><li><em>Example 5.</em></li></ul><pre class="language-jsx"><code class="language-js">    <span class="token keyword">const</span> el_divInner <span class="token operator">=</span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el_root<span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'importantInfo'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">byClass</span><span class="token punctuation">(</span><span class="token string">'importantInfo_inner'</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token punctuation">[</span> summary<span class="token punctuation">,</span> content<span class="token punctuation">,</span> footer <span class="token punctuation">]</span> <span class="token operator">=</span> el_divInner<span class="token punctuation">.</span>allChildren<span class="token punctuation">.</span><span class="token function">withClass</span><span class="token punctuation">(</span><span class="token string">'commonClNm'</span><span class="token punctuation">)</span>
</code></pre><p><em>Note that the order of the array returned from <code>allChildren.withClass</code> here is dependent on the order of the elements within their parent.</em></p><h2 id="how-it-works">How it Works</h2><p>The ElFinder function accepts a Hyperapp VDOM element (Some compiled JSX expression, or a direct call to Hyperapp’s <code>h</code> function) as an argument, and returns a new object containing all of the element’s properties, as well as some new ones; We add new properties containing composable functions allowing us to dig deeper into the VDOM tree. Most of these functions return a new call to ElFinder, as well as a few that return the raw Hyperapp VDOM element (primarily used when verifying a pure text child element).</p><p>Here’s a rundown of the shape of the object returned from ElFinder:</p><ul><li><em>Existing Hyperapp VDOM Element Properties</em><ul><li>nodeName, attributes, children, key</li></ul></li><li><em>child</em><ul><li><strong>atIndexRaw</strong> - Child at index (raw h call object)</li><li><strong>atIndex</strong> - ElFinder instance of child at index</li></ul></li><li><em>firstChild</em><ul><li><strong>raw</strong> - first child element (raw h call object)</li><li><strong>byIndex</strong> - ElFinder instance of first child, accessed by index in parent’s children array</li><li><strong>byId</strong> - ElFinder instance of first child with matching ID attribute</li><li><strong>byType</strong> - ElFinder instance of first child with matching element type (nodeName property)</li><li><strong>byClass</strong> - ElFinder instance of first child with matching className atrribute</li></ul></li><li><em>allChildren</em><ul><li><strong>ofType</strong> - array of ElFinder instances for each child matching element type (nodeName property)</li><li><strong>withClass</strong> - array of ElFinder instances for each child with matching className attribute</li></ul></li></ul><h2 id="full-elfinder-function">Full ElFinder function</h2><pre class="language-jsx"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">ElFinder</span> <span class="token operator">=</span> el <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// carry over existing element properties</span>
    <span class="token operator">...</span>el<span class="token punctuation">,</span>

    child<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// child at index (raw vdom object)</span>
        <span class="token comment">// does not wrap in ElFinder object</span>
        atIndexRaw<span class="token punctuation">:</span> index <span class="token operator">=></span> el<span class="token punctuation">.</span>children<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>

        <span class="token comment">// ElFinder instance of child at index</span>
        atIndex<span class="token punctuation">:</span> index <span class="token operator">=></span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>children<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    firstChild<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// first child element (raw vdom object)</span>
        <span class="token comment">// does not wrap in ElFinder object</span>
        raw<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

        <span class="token comment">// ElFinder instance of element's first child element</span>
        byIndex<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// ElFinder instance of first child element with matching ID attribute</span>
        byId<span class="token punctuation">:</span> id <span class="token operator">=></span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// ElFinder instance of first child element with matching type (nodeName property)</span>
        byType<span class="token punctuation">:</span> type <span class="token operator">=></span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// ElFinder instance of first child element with matching className attribute</span>
        <span class="token comment">// return an element only if the attribute exists (truthy) & includes the passed string</span>
        byClass<span class="token punctuation">:</span> className <span class="token operator">=></span>
                <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className
                        <span class="token operator">?</span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span>
                        <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    allChildren<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// array of ElFinder instances for each child matching element type (nodeName property)</span>
        ofType<span class="token punctuation">:</span> type <span class="token operator">=></span>
                el<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> type<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>el <span class="token operator">=></span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// array of ElFinder instances for each child with matching className attribute</span>
        withClass<span class="token punctuation">:</span> className <span class="token operator">=></span>
                el<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>el <span class="token operator">=></span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className
                        <span class="token operator">?</span> el<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span>
                        <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>el <span class="token operator">=></span> <span class="token function">ElFinder</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>The focuses of this utility were to stay tiny, reusable, and to offer a composable workflow that stays close to the familiar Hyperapp VDOM element shape.</p><p>Feel free to use this function in your own tests. Currently there are no plans to publish it as a Node module; I don’t think it warrants a module, though this may change in the future.</p></div></main></div></div><script>!function(f){function e(e){for(var t,r,n=e[0],o=e[1],a=e[2],c=0,u=[];c<n.length;c++)r=n[c],d[r]&&u.push(d[r][0]),d[r]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(f[t]=o[t]);for(p&&p(e);u.length;)u.shift()();return l.push.apply(l,a||[]),i()}function i(){for(var e,t=0;t<l.length;t++){for(var r=l[t],n=!0,o=1;o<r.length;o++){var a=r[o];0!==d[a]&&(n=!1)}n&&(l.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},u={17:0},d={17:0},l=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return f[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(l){var e=[];u[l]?e.push(u[l]):0!==u[l]&&{2:1,6:1}[l]&&e.push(u[l]=new Promise(function(e,n){for(var t="static/css/"+({}[l]||l)+"."+{0:"31d6cfe0",2:"31d49b7e",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"1824b1f2",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"31d6cfe0",15:"31d6cfe0"}[l]+".chunk.css",o=s.p+t,r=document.getElementsByTagName("link"),a=0;a<r.length;a++){var c=(f=r[a]).getAttribute("data-href")||f.getAttribute("href");if("stylesheet"===f.rel&&(c===t||c===o))return e()}var u=document.getElementsByTagName("style");for(a=0;a<u.length;a++){var f;if((c=(f=u[a]).getAttribute("data-href"))===t||c===o)return e()}var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=e,i.onerror=function(e){var t=e&&e.target&&e.target.src||o,r=new Error("Loading CSS chunk "+l+" failed.\n("+t+")");r.request=t,n(r)},i.href=o,document.getElementsByTagName("head")[0].appendChild(i)}).then(function(){u[l]=0}));var r=d[l];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=d[l]=[e,t]});e.push(r[2]=t);var n,o=document.getElementsByTagName("head")[0],a=document.createElement("script");a.charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.src=s.p+"static/js/"+({}[l]||l)+"."+{0:"0206793b",2:"62eb3000",3:"c7af5567",4:"8dd27aae",5:"4600a1b2",6:"990c5257",7:"30ea74c0",8:"7512e075",9:"ebbe1e98",10:"abf27806",11:"0908009d",12:"3054338b",13:"d124050a",14:"25c1c560",15:"bec5874a"}[l]+".chunk.js",n=function(e){a.onerror=a.onload=null,clearTimeout(c);var t=d[l];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,o=new Error("Loading chunk "+l+" failed.\n("+r+": "+n+")");o.type=r,o.request=n,t[1](o)}d[l]=void 0}};var c=setTimeout(function(){n({type:"timeout",target:a})},12e4);a.onerror=a.onload=n,o.appendChild(a)}return Promise.all(e)},s.m=f,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var p=n;i()}([])</script><script src="/static/js/16.685cfdbc.chunk.js"></script><script src="/static/js/main.c79bbdec.chunk.js"></script></body></html>