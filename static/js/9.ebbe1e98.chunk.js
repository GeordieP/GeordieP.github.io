(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{11:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.withMDXComponents=void 0;var a,s=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},o=t(1),p=(a=o)&&a.__esModule?a:{default:a};var i=p.default.createContext({}),r=i.Provider,c=i.Consumer;n.withMDXComponents=function(e){return function(n){var t=n.components,a=function(e,n){var t={};for(var a in e)n.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}(n,["components"]);return p.default.createElement(c,null,function(n){return p.default.createElement(e,s({components:t||n},a))})}};n.default=function(e){var n=e.components,t=e.children;return p.default.createElement(r,{value:n},t)}},12:function(e,n,t){"use strict";function a(e,n){if(null==e)return{};var t,a,s=function(e,n){if(null==e)return{};var t,a,s={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}t.d(n,"a",function(){return a})},13:function(e,n,t){"use strict";function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}t.d(n,"a",function(){return a})},14:function(e,n,t){"use strict";function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}t.d(n,"a",function(){return s})},15:function(e,n,t){"use strict";function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}t.d(n,"a",function(){return a})},16:function(e,n,t){"use strict";function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}t.d(n,"a",function(){return a})},17:function(e,n,t){"use strict";function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return(s="function"===typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}var o=t(15);function p(e,n){return!n||"object"!==s(n)&&"function"!==typeof n?Object(o.a)(e):n}t.d(n,"a",function(){return p})},18:function(e,n,t){"use strict";function a(e,n){return(a=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function s(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&a(e,n)}t.d(n,"a",function(){return s})},19:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=t(20);Object.defineProperty(n,"MDXTag",{enumerable:!0,get:function(){return o(a).default}});var s=t(11);function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"MDXProvider",{enumerable:!0,get:function(){return o(s).default}})},20:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,s=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},o=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),p=t(1),i=(a=p)&&a.__esModule?a:{default:a},r=t(11);var c={inlineCode:"code",wrapper:"div"},l=function(e){function n(){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==typeof n&&"function"!==typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,p.Component),o(n,[{key:"render",value:function(){var e=this.props,n=e.name,t=e.parentName,a=e.props,o=void 0===a?{}:a,p=e.children,r=e.components,l=void 0===r?{}:r,u=e.Layout,m=e.layoutProps,d=l[t+"."+n]||l[n]||c[n]||n;return u?i.default.createElement(u,s({components:l},m),i.default.createElement(d,o,p)):i.default.createElement(d,o,p)}}]),n}();n.default=(0,r.withMDXComponents)(l)},330:function(e,n,t){"use strict";t.r(n),t.d(n,"default",function(){return m}),t.d(n,"tableOfContents",function(){return d}),t.d(n,"frontMatter",function(){return h});var a=t(12),s=t(13),o=t(14),p=t(17),i=t(16),r=t(18),c=t(1),l=t.n(c),u=t(19),m=function(e){function n(e){var t;return Object(s.a)(this,n),(t=Object(p.a)(this,Object(i.a)(n).call(this,e))).layout=null,t}return Object(r.a)(n,e),Object(o.a)(n,[{key:"render",value:function(){var e=this.props,n=e.components;Object(a.a)(e,["components"]);return l.a.createElement(u.MDXTag,{name:"wrapper",components:n},l.a.createElement(u.MDXTag,{name:"h1",components:n,props:{id:"building-swift-shop---week-1-nov-16---23-2019"}},"Building Swift Shop - Week 1 (Nov 16 \u2212 23, 2019)"),l.a.createElement(u.MDXTag,{name:"h4",components:n,props:{id:"nov-24-2019"}},"Nov 24, 2019"),l.a.createElement(u.MDXTag,{name:"p",components:n},"This is the beginning of a series of (hopefully) weekly blog posts about my first experiences using SwiftUI to build an iOS app."),l.a.createElement(u.MDXTag,{name:"h1",components:n,props:{id:"about-the-app"}},"About the app"),l.a.createElement(u.MDXTag,{name:"p",components:n},"The app being built in this series of posts is a shopping list app called ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/GeordieP/swiftshop"}},"Swift Shop")," (pun somewhat intended). It\u2019s my first real mobile app, and I plan on publishing it to the iOS App Store when it\u2019s complete."),l.a.createElement(u.MDXTag,{name:"p",components:n},"The initial version of this was a small ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/GeordieP/shopping-proto"}},"web-based prototype")," built with React in December of 2018. It was mainly a playground in which to explore the recently released ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://reactjs.org/docs/hooks-intro.html"}},"React Hooks")," pattern. The project was completed rather quickly, and I had some desire to turn it into a real thing, as it captures the workflow I\u2019d prefer when setting up shopping lists."),l.a.createElement(u.MDXTag,{name:"p",components:n},"The next version was intended to be written using React Native, but this never came to be, as the support for Hooks wouldn\u2019t be stable for many months to come."),l.a.createElement(u.MDXTag,{name:"p",components:n},"Some time later, ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://ionicframework.com/blog/announcing-ionic-react/"}},"Ionic React")," was officially announced, and I ended up building a good amount of the app in this toolkit (View this project ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/GeordieP/shopping-list"}},"here"),"), before deciding that Ionic React was not the solution I was looking for. I instead set my sights on learning SwiftUI, as it seemed to be promising (and slightly React-like!), and producing the app in a platform-native framework would hopefully ensure that everything stays fast and correctly adheres to the iOS human interface guidelines."),l.a.createElement(u.MDXTag,{name:"h1",components:n,props:{id:"initial-concerns"}},"Initial Concerns"),l.a.createElement(u.MDXTag,{name:"p",components:n},"Going into SwiftUI with zero prior knowledge of how iOS apps are built or packaged, how data is managed, and how the framework interacts with state left me with several unknowns up-front:"),l.a.createElement(u.MDXTag,{name:"h2",components:n,props:{id:"state-management---how-do-developers-usually-manage-state-in-swiftui-apps"}},l.a.createElement(u.MDXTag,{name:"strong",components:n,parentName:"h2"},"State Management")," - How do developers usually manage state in SwiftUI apps?"),l.a.createElement(u.MDXTag,{name:"p",components:n},"During a quick initial search, there were very few resources talking about this directly. I decided to see if anybody had created an \u201cAwesome SwiftUI\u201d page, and indeed, ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/chinsyo/awesome-swiftui"}},"they had"),". It was in this list that I found ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/StevenLambion/SwiftDux"}},"SwiftDux"),", which felt like a comfortable choice, given my Redux experience with React."),l.a.createElement(u.MDXTag,{name:"h2",components:n,props:{id:"persistence---how-do-we-interact-with-device-storage-using-swift-and-how-does-this-integrate-with-swiftui"}},l.a.createElement(u.MDXTag,{name:"strong",components:n,parentName:"h2"},"Persistence")," - How do we interact with device storage using Swift, and how does this integrate with SwiftUI?"),l.a.createElement(u.MDXTag,{name:"p",components:n},"Not much searching required on this one, as SwiftDux ships with a ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://stevenlambion.github.io/SwiftDux/persisting-state.html"}},"simple state persistence middleware")," that seemed good enough to start with."),l.a.createElement(u.MDXTag,{name:"h2",components:n,props:{id:"list-filtering---how-do-we-manage-our-list-filtering-logic"}},l.a.createElement(u.MDXTag,{name:"strong",components:n,parentName:"h2"},"List Filtering")," - How do we manage our list filtering logic?"),l.a.createElement(u.MDXTag,{name:"p",components:n},"Previous prototypes of the app relied heavily on a custom React Hook for filtering the lists of items in a very composable manner that was a joy to use (Alright, I may be biased \ud83d\ude05). SwiftUI obviously doesn\u2019t have Hooks, so what will the approach be to replicate this? How close can we get to the easy-to-use API of the Hook?"),l.a.createElement(u.MDXTag,{name:"h1",components:n,props:{id:"starting-out"}},"Starting Out"),l.a.createElement(u.MDXTag,{name:"p",components:n},"Writing the initial views and wiring up some basic state management with SwiftDux was a breeze. While there were occasional cases where Xcode\u2019s completion would provide less-than-useful options, or stubborn type errors would persist until an editor restart, the experience was pleasant. It is however apparent that SwiftUI is new and a bit rough around the edges (e.g. ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://stackoverflow.com/questions/58724301/cannot-convert-value-of-type-bindingint-to-expected-argument-type-binding"}},"Errors originating in a child View\u2019s code being presented in the parent View"),"), but these problems will no doubt see improvement over time."),l.a.createElement(u.MDXTag,{name:"p",components:n},"The real beauty of SwiftUI is its contextual awareness. Unlike the web where most styling is done by hand, iOS has a very consistent set of controls for most of the scenarios one would encounter. The framework has been thoughtfully designed to give developers access to these controls with minimal effort; for example, adding the common \u201cslide to delete\u201d button to each item in a List view is as easy as calling a method on the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"ForEach")," block itself:"),l.a.createElement(u.MDXTag,{name:"pre",components:n,props:{className:"language-diff"}},l.a.createElement(u.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-diff",metastring:null,dangerouslySetInnerHTML:{__html:'  List {\n    ForEach(props.products) { p in\n      Text(p.name)\n<span class="token inserted">+   }.onDelete(perform: deleteProduct)</span>\n  }\n\n  // ...\n  // Defined elsewhere in the View struct:\n\n<span class="token inserted">+ func deleteProduct(at: IndexSet) {</span>\n<span class="token inserted">+   // Call a SwiftDux action</span>\n<span class="token inserted">+   self.dispatch(ProductActions.deleteProduct( /* ... */ )</span>\n<span class="token inserted">+ }</span>\n'}}})),l.a.createElement(u.MDXTag,{name:"h2",components:n,props:{id:"attempting-persistence"}},"Attempting Persistence"),l.a.createElement(u.MDXTag,{name:"p",components:n},"After successfully getting some basic state management and Views written, I tried out the SwiftDux bundled JSON persistence middleware. Unfortunately, it didn\u2019t work. Something in the SwiftDux ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"OrderedState")," type didn\u2019t like being serialized, and the app would throw a runtime exception when calling ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"JSONEncoder.encode()")," on the state object."),l.a.createElement(u.MDXTag,{name:"pre",components:n},l.a.createElement(u.MDXTag,{name:"code",components:n,parentName:"pre",props:{metastring:null}},"  JSONEncoder.encode() throws Thread 1: EXC_BAD_ACCESS (code=2, address=0x105438309) error\n")),l.a.createElement(u.MDXTag,{name:"p",components:n},"Trying to diagnose the problem, I made a new SwiftUI project to try and reproduce the error in a more isolated environment, and was able to do so:"),l.a.createElement(u.MDXTag,{name:"pre",components:n,props:{className:"language-swift"}},l.a.createElement(u.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metastring:null,dangerouslySetInnerHTML:{__html:'  <span class="token comment">// ...</span>\n\n  <span class="token keyword">struct</span> <span class="token builtin">Item</span><span class="token punctuation">:</span> <span class="token builtin">IdentifiableState</span><span class="token punctuation">,</span> <span class="token builtin">Codable</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token builtin">String</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token builtin">OrderedState</span><span class="token operator">&#x3C;</span><span class="token builtin">Item</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> <span class="token function">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token comment">// throws!</span>\n\n  <span class="token comment">// ...</span>\n\n  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter variable">\\(</span><span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> json<span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span><span class="token delimiter variable">)</span></span>"</span><span class="token punctuation">)</span> <span class="token comment">// never reached</span>\n'}}})),l.a.createElement(u.MDXTag,{name:"p",components:n},"I then created a second project (this time an empty Swift project, with no SwiftUI or SwiftDux dependencies), and copied some source files of interest directly from the SwiftDux repository (namely ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"OrderedState"),", ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"IdentifiableState"),") and ran a similar test. Strangely, this version worked just fine."),l.a.createElement(u.MDXTag,{name:"pre",components:n,props:{className:"language-swift"}},l.a.createElement(u.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metastring:null,dangerouslySetInnerHTML:{__html:'  <span class="token keyword">import</span> <span class="token builtin">Foundation</span>\n\n  <span class="token keyword">struct</span> <span class="token builtin">Item</span><span class="token punctuation">:</span> <span class="token builtin">IdentifiableState</span><span class="token punctuation">,</span> <span class="token builtin">Codable</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token builtin">String</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">var</span> state <span class="token operator">=</span> <span class="token function">OrderedState</span><span class="token punctuation">(</span><span class="token function">Item</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string">"1st"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> <span class="token function">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token comment">// no problems</span>\n  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter variable">\\(</span><span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> json<span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span><span class="token delimiter variable">)</span></span>"</span><span class="token punctuation">)</span> <span class="token comment">// prints the JSON string as expected</span>\n'}}})),l.a.createElement(u.MDXTag,{name:"p",components:n},"I decided to hold off on persistence, instead focusing on other parts of the app. I will later open an issue on the SwiftDux GitHub repository explaining the issue and including the reproduction cases."),l.a.createElement(u.MDXTag,{name:"h2",components:n,props:{id:"list-filtering"}},"List Filtering"),l.a.createElement(u.MDXTag,{name:"p",components:n},"The ",l.a.createElement(u.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/GeordieP/shopping-list/blob/master/src/hooks/useFilters.ts"}},"Hook")," for managing filters in the React version(s) of the app is very simple to use; we call the hook in our component, and it returns us an object containing functions to add or remove a filter function (",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"(T) => Boolean"),") by name, as well as a function to apply the stored filters to a given collection (",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"applyFilters(initialCollection: T[]) => filteredCollection: T[]"),"). We call ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"applyFilters")," on our collection of list items, and render the filtered list as normal. The add/remove filter functions are passed to other components that are concerned with managing filter state, such as a search bar component that will update a \u201csearch\u201d filter function whenever the user types a character, causing the filtered list to re-render and represent the new desired state. Our list rendering is therefore only concerned with rendering the list, and never with managing what filters are present."),l.a.createElement(u.MDXTag,{name:"p",components:n},"I was initially afraid a lot of this API would get more verbose in SwiftUI, or at the very least, more tightly coupled to the Views rendering the content. After a bit of playing around, the solution is more than satisfactory."),l.a.createElement(u.MDXTag,{name:"p",components:n},"The first piece is a class called ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"FilterManager"),", which conforms to the Swift ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"ObservableObject")," protocol. In SwiftUI, instances of this type can be bound to a View struct using the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"@ObservedObject")," property wrapper. SwiftUI will automatically re-render the View when a published var inside the observed field changes (these published vars are fields inside the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"ObservedObject")," wrapped with ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"@Published"),")."),l.a.createElement(u.MDXTag,{name:"p",components:n},"The ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"FilterManager")," class behaves similarly to the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"useFilters")," Hook from the React version; it maintains an internal collection of filter functions (closures), and exposes methods to add/remove closures by name, along with a method to apply the filters to a given collection."),l.a.createElement(u.MDXTag,{name:"p",components:n},l.a.createElement(u.MDXTag,{name:"strong",components:n,parentName:"p"},"FilterManager.swift")),l.a.createElement(u.MDXTag,{name:"pre",components:n,props:{className:"language-swift"}},l.a.createElement(u.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metastring:null,dangerouslySetInnerHTML:{__html:'<span class="token keyword">class</span> <span class="token class-name">FilterManager</span><span class="token operator">&#x3C;</span>T<span class="token operator">></span> <span class="token punctuation">:</span> <span class="token builtin">ObservableObject</span> <span class="token punctuation">{</span>\n  <span class="token keyword">typealias</span> <span class="token builtin">Filter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Bool</span>\n  @<span class="token builtin">Published</span> <span class="token keyword">var</span> filters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">:</span> <span class="token builtin">Filter</span><span class="token punctuation">]</span>\n\n  <span class="token keyword">init</span><span class="token punctuation">(</span>defaultFilters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">:</span> <span class="token builtin">Filter</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">:</span> <span class="token builtin">Filter</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    filters <span class="token operator">=</span> defaultFilters\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">/// Update a filter by name, or insert it if it does not exist.</span>\n  <span class="token keyword">func</span> <span class="token function">upsert</span><span class="token punctuation">(</span><span class="token number">_</span> name<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token number">_</span> filterFn<span class="token punctuation">:</span> @escaping <span class="token builtin">Filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    filters<span class="token punctuation">.</span><span class="token function">updateValue</span><span class="token punctuation">(</span>filterFn<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> name<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">/// Remove a filter by name.</span>\n  <span class="token keyword">func</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">_</span> name<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    filters<span class="token punctuation">.</span><span class="token function">removeValue</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> name<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">/// Apply the current list of filters to a collection of T.</span>\n  <span class="token keyword">func</span> <span class="token function">apply</span><span class="token punctuation">(</span>to collection<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">{</span>\n    filters<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token number">0</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n'}}})),l.a.createElement(u.MDXTag,{name:"p",components:n},l.a.createElement(u.MDXTag,{name:"strong",components:n,parentName:"p"},"Usage")," (in SwiftUI View ProductsPage.swift)"),l.a.createElement(u.MDXTag,{name:"pre",components:n,props:{className:"language-swift"}},l.a.createElement(u.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metastring:null,dangerouslySetInnerHTML:{__html:'<span class="token keyword">struct</span> <span class="token builtin">ProductsPage</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>\n  @<span class="token builtin">ObservedObject</span> <span class="token keyword">private</span> <span class="token keyword">var</span> filters <span class="token operator">=</span> <span class="token builtin">FilterManager</span><span class="token operator">&#x3C;</span><span class="token builtin">Product</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token comment">// ...</span>\n\n  <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>\n    <span class="token builtin">List</span> <span class="token punctuation">{</span>\n      <span class="token function">ForEach</span><span class="token punctuation">(</span>filters<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> props<span class="token punctuation">.</span>products<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n'}}})),l.a.createElement(u.MDXTag,{name:"p",components:n},"Another View containing a search field would be rendered alongside the List shown above, and would receive the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"FilterManager")," instance through its initializer, internally calling the upsert and remove methods as needed. Whenever the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"ProductsPage")," \u201cfilters\u201d observed property updates, the view re-renders and we display the filtered collection."),l.a.createElement(u.MDXTag,{name:"p",components:n},"A small issue with this approach was that it broke the previously-working removal of list items; the ForEach had a chained ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},".onDelete")," method whose passed closure would receive the index (really an ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"IndexSet"),") of an item to remove, and we would pass that index through a SwiftDux action to remove the item from the store. Unfortunately, when the list is filtered, the indices don\u2019t line up; index 2 in the filtered list might actually be index 6 in the SwiftDux store, so when we delete at index 2, we delete something that may not even be visible to the user."),l.a.createElement(u.MDXTag,{name:"p",components:n},"To work around this, I first switched the SwiftDux actions to perform their removal operations by ID rather than index. This presented a problem, as the aforementioned ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"onDelete")," method will only pass the indices to be removed, and since we\u2019re only ever creating the filtered collection inside the rendered view body, we have no access to it with which to map a given list index to an item ID (and it seems like there isn\u2019t an obvious way to add the filtered list as its own property on the struct and have it still react to changes in the filters state). To solve this, the list rendering was extracted to its own View, which would receive the filtered list as well as a ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"deleteItem")," closure through its initializer. An additional function inside this View would be used in the list ForEach, and would look up the item in the (already filtered!) collection, grab its ID, then call the ",l.a.createElement(u.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"deleteItem")," closure provided by the parent View."),l.a.createElement(u.MDXTag,{name:"p",components:n},"After these changes, the list could be filtered and deleting items worked as intended."),l.a.createElement(u.MDXTag,{name:"h2",components:n,props:{id:"progress---week-1"}},"Progress - Week 1"),l.a.createElement(u.MDXTag,{name:"ul",components:n},l.a.createElement(u.MDXTag,{name:"li",components:n,parentName:"ul"},"Tab navigation bar"),l.a.createElement(u.MDXTag,{name:"li",components:n,parentName:"ul"},"Basic form to add a new product to the list"),l.a.createElement(u.MDXTag,{name:"li",components:n,parentName:"ul"},'Buttons to add and remove a placeholder search filter (searching for any products containing the string "ir")'),l.a.createElement(u.MDXTag,{name:"li",components:n,parentName:"ul"},"Slide to delete a product from the list")),l.a.createElement("div",{align:"center"},l.a.createElement("video",{controls:!0,alt:"Week 1 Progress Video"},l.a.createElement("source",{src:"https://giant.gfycat.com/SlimLameCardinal.mp4",type:"video/mp4"}))))}}]),n}(l.a.Component),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{id:"state-management---how-do-developers-usually-manage-state-in-swiftui-apps",level:2,title:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.MDXTag,{name:"strong",components:e},"State Management")," - How do developers usually manage state in SwiftUI apps?"),children:[]},{id:"persistence---how-do-we-interact-with-device-storage-using-swift-and-how-does-this-integrate-with-swiftui",level:2,title:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.MDXTag,{name:"strong",components:e},"Persistence")," - How do we interact with device storage using Swift, and how does this integrate with SwiftUI?"),children:[]},{id:"list-filtering---how-do-we-manage-our-list-filtering-logic",level:2,title:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.MDXTag,{name:"strong",components:e},"List Filtering")," - How do we manage our list filtering logic?"),children:[]},{id:"attempting-persistence",level:2,title:"Attempting Persistence",children:[]},{id:"list-filtering",level:2,title:"List Filtering",children:[]},{id:"progress---week-1",level:2,title:"Progress - Week 1",children:[]}]},h={}}}]);
//# sourceMappingURL=9.ebbe1e98.chunk.js.map